import React from 'react';
import { Outlet, NavLink } from 'react-router-dom';
<% if (authProvider === 'clerk') { %>
import { UserButton } from '@clerk/clerk-react';
<% } else if (authProvider === 'auth0') { %>
import { useAuth0 } from '@auth0/auth0-react';
<% } %>

// Navigation items derived from application pages
const navItems = [
  { to: '/dashboard', label: 'Dashboard' },
<% pages.forEach(page => { %>
  { to: '<%= page.route %>', label: '<%= page.name %>' },
<% }); %>
];

export default function Layout() {
<% if (authProvider === 'auth0') { %>
  const { logout, user } = useAuth0();
<% } %>

  return (
    <div className="layout">
      <aside className="sidebar">
        <div className="sidebar-title"><%= app.name || 'Stalmer1 App' %></div>
        <nav>
          <ul className="nav-list">
            {navItems.map((item) => (
              <li key={item.to} className="nav-item">
                <NavLink
                  to={item.to}
                  className={({isActive}) => isActive ? "nav-link active" : "nav-link"}
                >
                  {item.label}
                </NavLink>
              </li>
            ))}
          </ul>
        </nav>
        <div className="user-section" style={{ marginTop: 'auto', paddingTop: '20px' }}>
        <% if (authProvider === 'clerk') { %>
          <UserButton afterSignOutUrl="/login" />
        <% } else if (authProvider === 'auth0') { %>
          <div style={{ display: 'flex', alignItems: 'center' }}>
            {user?.picture && (
              <img 
                src={user.picture} 
                alt={user.name || 'User'} 
                style={{ width: '32px', height: '32px', borderRadius: '50%', marginRight: '8px' }} 
              />
            )}
            <span>{user?.name}</span>
            <button 
              onClick={() => logout({ logoutParams: { returnTo: window.location.origin + '/login' } })}
              style={{ marginLeft: '8px', fontSize: '0.8rem' }}
            >
              Logout
            </button>
          </div>
        <% } %>
        </div>
      </aside>
      <main className="main">
        <Outlet />
      </main>
    </div>
  );
}
